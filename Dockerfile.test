# syntax=docker/dockerfile:1
FROM node:22-alpine3.20 AS test

WORKDIR /app

# Install dependencies first to leverage Docker layer caching
COPY package.json package-lock.json ./
RUN npm ci --force

# Copy the full workspace and run tests + build
COPY . .

# Ensure CI-friendly output from test runners
ENV CI=true

# Lint, type-check, run unit tests, then build
CMD ["sh", "-lc", "npm run lint:frontend && npm run check && npm run test:frontend && npm run build"]
